<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>时间记录器</title>
  <link rel="manifest" href="manifest.json" />
  <style>
    /* 全局样式 */
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f2f2f2;
      color: #333;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    /* 实时钟样式 */
    #clock {
      font-size: 20px;
      margin: 20px 0;
      text-align: center;
      color: #317EFB;
    }

    .container {
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      padding: 20px;
      max-width: 400px;
      width: 90%;
      text-align: center;
      margin-bottom: 20px;
    }

    h1 {
      margin-top: 0;
      color: #317EFB;
    }

    button {
      display: block;
      width: 100%;
      padding: 12px;
      margin: 10px 0;
      font-size: 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.3s;
    }

    #workBtn {
      background-color: #4CAF50;
      color: #fff;
    }
    #workBtn:hover {
      background-color: #45a049;
    }

    #playBtn {
      background-color: #FF9800;
      color: #fff;
    }
    #playBtn:hover {
      background-color: #e68900;
    }

    #clearBtn {
      background-color: #f44336;
      color: #fff;
    }
    #clearBtn:hover {
      background-color: #d32f2f;
    }

    p {
      font-size: 18px;
      margin: 10px 0;
    }

    /* 为清空按钮和“差值”之间增加间距 */
    #clearBtn {
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <!-- 实时电子钟 -->
  <div id="clock">加载时间...</div>

  <div class="container">
    <h1>时间记录器</h1>
    <button id="workBtn">记录工作时间</button>
    <button id="playBtn">记录娱乐时间</button>
    <p>工作时长: <span id="workTime">0min</span></p>
    <p>娱乐时长: <span id="playTime">0min</span></p>
    <p>差值 (工作-娱乐): <span id="diffTime">0min</span></p>
    <!-- 将“一键清空”按钮放在差值下面 -->
    <button id="clearBtn">一键清空</button>
  </div>
  
  <script>
    // 实时电子钟更新函数
    function updateClock() {
      const now = new Date();
      const year = now.getFullYear();
      const month = String(now.getMonth() + 1).padStart(2, '0');
      const day = String(now.getDate()).padStart(2, '0');
      const hour = String(now.getHours()).padStart(2, '0');
      const minute = String(now.getMinutes()).padStart(2, '0');
      const second = String(now.getSeconds()).padStart(2, '0');
      document.getElementById('clock').textContent = `${year}年 ${month}月 ${day}日 ${hour}:${minute}:${second}`;
    }
    // 每秒更新一次时钟
    setInterval(updateClock, 1000);
    updateClock(); // 初始化时钟显示

    // 初始化和更新数据相关部分
    let events = JSON.parse(localStorage.getItem('events')) || [];

    function updateDisplay() {
      let workEvents = events.filter(e => e.type === 'work');
      let playEvents = events.filter(e => e.type === 'play');
      let workSum = workEvents.reduce((sum, e) => sum + e.value, 0);
      let playSum = playEvents.reduce((sum, e) => sum + e.value, 0);
      let diffSum = workSum - playSum;
      let workExpr = workEvents.map(e => e.value).join('+') || '0';
      let playExpr = playEvents.map(e => e.value).join('+') || '0';
      let diffExpr = events.map(e => (e.type === 'work' ? '+' + e.value : '-' + e.value)).join('');
      if(diffExpr.startsWith('+')) diffExpr = diffExpr.substring(1);
      document.getElementById('workTime').textContent = `${workExpr}=${workSum}min`;
      document.getElementById('playTime').textContent = `${playExpr}=${playSum}min`;
      document.getElementById('diffTime').textContent = `${diffExpr}=${diffSum}min`;
    }

    document.getElementById('workBtn').addEventListener('click', () => {
      const amount = parseFloat(prompt('你工作了多少分钟？'));
      if (!isNaN(amount) && amount > 0) {
        events.push({type: 'work', value: amount});
        localStorage.setItem('events', JSON.stringify(events));
        updateDisplay();
      }
    });

    document.getElementById('playBtn').addEventListener('click', () => {
      const amount = parseFloat(prompt('你娱乐了多少分钟？'));
      if (!isNaN(amount) && amount > 0) {
        events.push({type: 'play', value: amount});
        localStorage.setItem('events', JSON.stringify(events));
        updateDisplay();
      }
    });

    document.getElementById('clearBtn').addEventListener('click', () => {
      if(confirm("确认要清空所有记录吗？")) {
        events = [];
        localStorage.removeItem('events');
        updateDisplay();
      }
    });

    updateDisplay();

    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js')
        .then(registration => console.log('Service Worker 注册成功:', registration))
        .catch(error => console.log('Service Worker 注册失败:', error));
    }
  </script>
</body>
</html>
