<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>时间记录器</title>
  <link rel="manifest" href="manifest.json" />
  <style>
    /* 全局样式：冷淡风格 */
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #ffffff;
      color: #333;
      margin: 20px;
    }

    /* 实时钟样式，居中显示 */
    #clock {
      font-size: 20px;
      margin-bottom: 20px;
      text-align: center;
      color: #333;
    }

    h1 {
      color: #333;
      margin-bottom: 10px;
    }

    button {
      display: block;
      width: auto;
      padding: 10px 20px;
      margin: 10px 0;
      font-size: 16px;
      border: 1px solid #ccc;
      background: #f9f9f9;
      color: #333;
      border-radius: 4px;
      cursor: pointer;
    }

    button:hover {
      background: #eee;
    }

    p {
      font-size: 18px;
      margin: 10px 0;
    }

    /* 为“一键清空”按钮增加上方间距，使其远离其他元素 */
    #clearBtn {
      margin-top: 40px;
    }
  </style>
</head>
<body>
  <!-- 实时电子钟 -->
  <div id="clock">加载时间...</div>

  <h1>时间记录器</h1>

  <!-- 工作相关按钮 -->
  <button id="workBtn">记录工作时间</button>
  <button id="startWorkBtn">开始工作</button>
  <button id="stopWorkBtn" disabled>停止工作</button>

  <!-- 娱乐相关按钮 -->
  <button id="playBtn">记录娱乐时间</button>
  <button id="startPlayBtn">开始娱乐</button>
  <button id="stopPlayBtn" disabled>停止娱乐</button>

  <p>工作时长: <span id="workTime">0min</span></p>
  <p>娱乐时长: <span id="playTime">0min</span></p>
  <p>差值 (工作-娱乐): <span id="diffTime">0min</span></p>

  <!-- “一键清空”按钮放在最下面 -->
  <button id="clearBtn">一键清空</button>
  
  <script>
    // 实时电子钟更新函数
    function updateClock() {
      const now = new Date();
      const year = now.getFullYear();
      const month = String(now.getMonth() + 1).padStart(2, '0');
      const day = String(now.getDate()).padStart(2, '0');
      const hour = String(now.getHours()).padStart(2, '0');
      const minute = String(now.getMinutes()).padStart(2, '0');
      const second = String(now.getSeconds()).padStart(2, '0');
      document.getElementById('clock').textContent = `${year}年 ${month}月 ${day}日 ${hour}:${minute}:${second}`;
    }
    setInterval(updateClock, 1000);
    updateClock();

    // 初始化数据和定时器变量
    let events = JSON.parse(localStorage.getItem('events')) || [];
    let workTimerStart = null;
    let playTimerStart = null;

    function updateDisplay() {
      let workEvents = events.filter(e => e.type === 'work');
      let playEvents = events.filter(e => e.type === 'play');
      let workSum = workEvents.reduce((sum, e) => sum + e.value, 0);
      let playSum = playEvents.reduce((sum, e) => sum + e.value, 0);
      let diffSum = workSum - playSum;
      let workExpr = workEvents.map(e => e.value).join('+') || '0';
      let playExpr = playEvents.map(e => e.value).join('+') || '0';
      let diffExpr = events.map(e => (e.type === 'work' ? '+' + e.value : '-' + e.value)).join('');
      if(diffExpr.startsWith('+')) diffExpr = diffExpr.substring(1);
      document.getElementById('workTime').textContent = `${workExpr}=${workSum}min`;
      document.getElementById('playTime').textContent = `${playExpr}=${playSum}min`;
      document.getElementById('diffTime').textContent = `${diffExpr}=${diffSum}min`;
    }

    document.getElementById('workBtn').addEventListener('click', () => {
      const amount = parseFloat(prompt('你工作了多少分钟？'));
      if (!isNaN(amount) && amount > 0) {
        events.push({type: 'work', value: amount});
        localStorage.setItem('events', JSON.stringify(events));
        updateDisplay();
      }
    });

    document.getElementById('playBtn').addEventListener('click', () => {
      const amount = parseFloat(prompt('你娱乐了多少分钟？'));
      if (!isNaN(amount) && amount > 0) {
        events.push({type: 'play', value: amount});
        localStorage.setItem('events', JSON.stringify(events));
        updateDisplay();
      }
    });

    // 开始工作和停止工作逻辑
    document.getElementById('startWorkBtn').addEventListener('click', () => {
      if(workTimerStart === null) {
        workTimerStart = Date.now();
        document.getElementById('startWorkBtn').disabled = true;
        document.getElementById('stopWorkBtn').disabled = false;
      }
    });

    document.getElementById('stopWorkBtn').addEventListener('click', () => {
      if(workTimerStart !== null) {
        let elapsed = (Date.now() - workTimerStart) / 60000; // 转换为分钟
        elapsed = Math.round(elapsed);
        if(elapsed > 0) {
          events.push({type: 'work', value: elapsed});
          localStorage.setItem('events', JSON.stringify(events));
          updateDisplay();
        }
        workTimerStart = null;
        document.getElementById('startWorkBtn').disabled = false;
        document.getElementById('stopWorkBtn').disabled = true;
      }
    });

    // 开始娱乐和停止娱乐逻辑
    document.getElementById('startPlayBtn').addEventListener('click', () => {
      if(playTimerStart === null) {
        playTimerStart = Date.now();
        document.getElementById('startPlayBtn').disabled = true;
        document.getElementById('stopPlayBtn').disabled = false;
      }
    });

    document.getElementById('stopPlayBtn').addEventListener('click', () => {
      if(playTimerStart !== null) {
        let elapsed = (Date.now() - playTimerStart) / 60000; // 转换为分钟
        elapsed = Math.round(elapsed);
        if(elapsed > 0) {
          events.push({type: 'play', value: elapsed});
          localStorage.setItem('events', JSON.stringify(events));
          updateDisplay();
        }
        playTimerStart = null;
        document.getElementById('startPlayBtn').disabled = false;
        document.getElementById('stopPlayBtn').disabled = true;
      }
    });

    document.getElementById('clearBtn').addEventListener('click', () => {
      if(confirm("确认要清空所有记录吗？")) {
        events = [];
        localStorage.removeItem('events');
        updateDisplay();
      }
    });

    updateDisplay();

    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js')
        .then(registration => console.log('Service Worker 注册成功:', registration))
        .catch(error => console.log('Service Worker 注册失败:', error));
    }
  </script>
</body>
</html>
